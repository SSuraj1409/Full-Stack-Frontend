<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>After School Lessons</title>

  <!-- Font Awesome Icons -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">

  <!-- Vue.js CDN -->
  <script src="https://cdn.jsdelivr.net/npm/vue@2.7.16/dist/vue.js"></script>

  <!-- External CSS file -->
  <link rel="stylesheet" href="style.css">
</head>

<body>
  <div id="app"> <!-- Vue root element -->

    <!-- HEADER SECTION -->
    <header>
      <h1>After School Lessons</h1>

      <!-- Cart button switches view between lessons and cart -->
      <button class="view-cart-btn" :disabled="cart.length === 0 && !showCart" @click="toggleView">
        <i class="fa-solid fa-cart-shopping"></i>

        <!-- Text changes depending on view -->
        {{ showCart ? 'Back to Lessons' : 'View Cart (' + cartCount + ')' }}
      </button>
    </header>

    <main>

      <!-- Lessons page (Shown when showCart is false) -->
      <div v-if="!showCart" class="main-layout">

        <!-- Sorting section -->
        <div class="sort-box">
          <h3>Sort Lessons</h3>

          <!-- Radio buttons to choose sort key -->
          <div class="sort-options">
            <label><input type="radio" value="subject" v-model="sortKey"> Subject</label>
            <label><input type="radio" value="location" v-model="sortKey"> Location</label>
            <label><input type="radio" value="price" v-model="sortKey"> Price</label>
            <label><input type="radio" value="spaces" v-model="sortKey"> Spaces</label>

            <!-- Ascending or Descending order -->
            <div class="order-toggle">
              <label><input type="radio" value="asc" v-model="sortOrder"> Ascending</label>
              <label><input type="radio" value="desc" v-model="sortOrder"> Descending</label>
            </div>
          </div>
        </div>

        <!-- Lessons section -->
        <section class="lesson-section">
          <p class="lesson-count">Lessons ({{ filteredAndSorted.length }})</p>

          <!-- Search bar -->
          <div class="search-container">
            <input type="text" v-model="searchQuery" placeholder="ðŸ” Search lesson..." class="search-bar"
              @input="handleSearchInput" />
          </div>

          <!-- Grid of lessons -->
          <div class="lesson-grid">

            <!-- Loop through lessons -->
            <div v-for="lesson in filteredAndSorted" :key="lesson.id" class="lesson-card">


              <!-- Lesson image -->
              <img :src="lesson.image" :alt="lesson.subject" class="lesson-img" />

              <div class="divider"></div>

              <!-- Lesson information -->
              <div class="lesson-info">
                <h3>{{ lesson.subject }}</h3>
                <p><strong>Lesson ID:</strong> {{ lesson.id }}</p>
                <p><strong>Location:</strong> {{ lesson.location }}</p>
                <p><strong>Price:</strong> <span class="price">${{ lesson.price.toFixed(2) }}</span></p>
                <p><strong>Spaces:</strong> {{ lesson.spaces }}</p>
              </div>

              <!-- Star rating display -->
              <div class="rating">
                <i v-for="n in 5" :key="n" :class="n <= lesson.rating ? 'fa-solid fa-star' : 'fa-regular fa-star'"></i>
              </div>

              <!-- Add to cart button (disabled when spaces = 0) -->
              <button :disabled="lesson.spaces === 0" @click="addToCart(lesson)">
                {{ lesson.spaces > 0 ? 'Add to Cart' : 'FULL' }}
              </button>
            </div>
          </div>
        </section>
      </div>

     <!-- Display empty cart message -->
      <div v-if="showCart">

        <div v-if="cart.length === 0" class="show-cart-empty order-placeholder">
          <div class="emoji">ðŸ›’</div>
          <h2>No lessons in the cart.</h2>
        </div>




        <!-- Cart page (Shown when showCart is true) -->
        <section v-else class="cart-section">
          <div class="cart-items">
            <h2>Cart Items</h2>

            <!-- If cart is empty show this message -->
            <div v-if="cart.length === 0">
              <p>No lessons in cart.</p>
            </div>

            <!-- Cart items list -->
            <div v-else class="cart-list">

              <!-- Loop through items in cart -->
              <div v-for="item in cart" :key="item.cartId" class="cart-item">
                <div class="cart-item-info">

                  <!-- Cart item image -->
                  <img :src="item.image" :alt="item.subject" class="lesson-img" />

                  <!-- Display all item details -->
                  <p><strong>Lesson ID:</strong> {{ item.id }}</p>
                  <p><strong>Subject:</strong> {{ item.subject }}</p>
                  <p><strong>Location:</strong> {{ item.location }}</p>
                  <p><strong>Price:</strong><span class="price"> ${{ item.price.toFixed(2) }}</span></p>

                  <!-- Star rating display -->
                  <div class="rating">
                    <i v-for="n in 5" :key="n"
                      :class="n <= item.rating ? 'fa-solid fa-star' : 'fa-regular fa-star'"></i>
                  </div>
                </div>

                <!-- Remove button -->
                <button @click="removeFromCart(item)">Remove</button>
              </div>
            </div>

            <!-- Total price of all cart items -->
            <div class="cart-total">
              Total: Â£{{ totalPrice.toFixed(2) }}
            </div>
          </div>

          <!-- Checkout Section -->
          <div class="checkout">
            <h2>Customer Details</h2>
            <div class="checkout-form">

              <!-- Full Name Input -->
              <label>Full Name:</label>
              <p v-if="nameError" class="error-msg">{{ nameError }}</p>
              <input type="text" v-model="name" @input="handleNameInput" :class="{ invalid: nameError }"
                placeholder="Enter Full Name" />

              <!-- Phone Number Input -->
              <label>Phone Number:</label>
              <p v-if="phoneError" class="error-msg">{{ phoneError }}</p>
              <input type="text" v-model="phone" @input="handlePhoneInput" :class="{ invalid: phoneError }"
                placeholder="Enter Phone Number" />

              <!-- Checkout button only enabled when fields valid -->
              <button :disabled="!canCheckout" @click="checkout">Checkout</button>
            </div>
          </div>
        </section>


        <!-- Pop-up for successful checkout(Shown when showPopup is true) -->
        <div v-if="showPopup" class="checkout-popup">
          <div class="checkout-popup-content">
            <div class="emoji">ðŸŽ‰</div>
            <h2>Thank You!</h2>
            <p>{{ checkoutMessage }}</p>
            <button @click="closePopup">Close</button>
          </div>
        </div>

      </div>

    </main>
  </div>

  <!-- External JS files -->
  <script src="fetchLessons.js"></script>
  <script src="fetchSearch.js"></script>
  <script src="fetchOrder.js"></script>
  <script src="fetchUpdateSpaces.js"></script>
  <script src="vue.js"></script> 

</body>

</html>